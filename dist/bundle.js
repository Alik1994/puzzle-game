(()=>{"use strict";function e(e,t){let n=e;U.innerHTML="";for(let e=0;e<n.length;e++)for(let a=0;a<n[e].length;a++){const o=document.createElement("div");if(o.classList.add("bar"),o.style.width=U.offsetWidth/t+"px",o.style.height=U.offsetWidth/t+"px",n[e][a]!==t*t)o.textContent=`${n[e][a]}`,U.append(o);else{const t=document.createElement("span");t.textContent=`${n[e][a]}`,t.classList.add("empty"),o.append(t),o.style.backgroundColor="#0abab5",U.append(o)}}}function t(e){if(J.classList.contains("isMute"))return;let t=new Audio;t.src=`../src/${e}.mp3`,t.autoplay=!0}let n,a=0,o=0,s=0;function d(){s++,60===s&&(o++,s=0),60===o&&(a++,o=0),B.textContent=`${a<10?"0"+a:a} : ${o<10?"0"+o:o} : ${s<10?"0"+s:s}`}const c=document.createElement("div"),l=document.createElement("img"),r=document.createElement("p"),i=document.createElement("p"),m=document.createElement("input"),u=document.createElement("button");let p,f;function v(){let e=m.value;const t=/[a-z]/i;for(let n=0;n<e.length;n++)t.test(e[n])?m.style.borderColor="#0abab5":(m.style.borderColor="red",e=e.replace(e[n],""));e.length>7&&(e=e.slice(0,7)),m.value=e}function L(e){"Enter"===e.key&&""!==m.value&&(y(),m.removeEventListener("keypress",L))}function E(e){let t=e.target;t.closest(".modal_btn")&&""!==m.value&&(y(),document.body.removeEventListener("click",E)),t.closest(".overlay")&&""!==m.value&&(y(),document.body.removeEventListener("click",E))}function y(){!function(){p=m.value;let e=[];e=[f,60*a+60*o+s],localStorage.setItem(p,JSON.stringify(e))}(),F.classList.remove("overlay"),c.classList.remove("modal"),F.classList.add("hidden"),c.classList.add("hidden"),ne(Number(Y.dataset.dim))}function h(d){const p=d.target.closest(".bar");if(!p)return;const y=K*K,h=Number(p.textContent),g=b(y,X),x=b(h,X);if(function(e,t){const n=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);return!(1!==n&&1!==a||0!==n&&0!==a)}(g,x)){!function(t,n,a){const o=a[t.y][t.x];a[t.y][t.x]=a[n.y][n.x],a[n.y][n.x]=o,e(a,K)}(g,x,X),f++,D.textContent=`${f}`,t("click");(function(){let e=[].concat(Q),t=X.flat(1/0);return e.join("")===t.join("")})()&&(clearInterval(n),setTimeout((function(){l.setAttribute("src","src/win_img.png"),r.textContent=`Hooray! You solved the puzzle in ${a<10?"0"+a:a} : ${o<10?"0"+o:o} : ${s<10?"0"+s:s} and ${f} moves!`,i.textContent="Please, enter your name!",m.value="",u.textContent="Ok",r.classList.add("modal_win"),i.classList.add("modal_user"),m.classList.add("modal_form"),u.classList.add("modal_btn"),c.append(l),c.append(r),c.append(i),c.append(m),c.append(u),document.body.prepend(c),F.classList.remove("hidden"),c.classList.remove("hidden"),F.classList.add("overlay"),c.classList.add("modal"),t("win"),m.addEventListener("input",v),m.addEventListener("keypress",L),document.body.addEventListener("click",E)}),1e3))}}function b(e,t){for(let n=0;n<t.length;n++)for(let a=0;a<t[n].length;a++)if(t[n][a]===e)return{x:a,y:n};return null}function g(e){let t=new Set,n=e*e;for(;t.size<n;){let e=Math.ceil(Math.random()*n);t.add(e)}return Array.from(t)}function x(e){const t=X.flat(1/0),n=K**2;let a=0;t[a]===n&&a++;const o=[];let s=0;for(;a<t.length-1;)s=C(a,t),a++,o.push(s);return(o.reduce(((e,t)=>e+t),0)+(b(n,X).y+1))%2==0}function C(e,t){let n=0;for(let a=e+1;a<t.length;a++)t[a]!==K**2&&t[a]<t[e]&&n++;return n}function k(e){let t=[],n=0,a=0;for(let e=K;e>0;e--)t.push([]);for(let o=0;o<e.length;o++)n>=K&&(n=0,a++),t[a].push(e[o]),n++;return t}function $(t){let n=t.target;var a;"size"===n.className&&(a=Number(n.dataset.sizeValue),K=a,Y.dataset.dim=`${K}`,te(K),ee(Q),q.textContent=`${K} х ${K}`,e(X,K),localStorage.clear())}const w=document.createElement("div"),M=document.createElement("h2"),S=document.createElement("table");function _(){!function(){let e=function(){let e=[];for(let t in localStorage){if(!localStorage.hasOwnProperty(t))continue;let n={};n.name=t,n.moves=JSON.parse(localStorage.getItem(t))[0],n.time=JSON.parse(localStorage.getItem(t))[1],e.push(n)}return e}();e.sort(((e,t)=>e.time===t.time?e.moves-t.moves:e.time-t.time)),e=e.slice(0,10),function(e){M.textContent="Top 10 winners for current size",w.append(M),S.innerHTML="";const t=document.createElement("tr"),n=document.createElement("th"),a=document.createElement("th"),o=document.createElement("th");n.textContent="User",a.textContent="Score",o.textContent="Time",t.append(n),t.append(a),t.append(o),S.append(t);let s=e;for(let e=0;e<s.length;e++){let t=document.createElement("tr"),n=document.createElement("td"),a=document.createElement("td"),o=document.createElement("td"),d=s[e].time,c=Math.trunc(d/3600),l=Math.trunc((d-3600*c)/60),r=Math.trunc(d-3600*c-60*l);n.textContent=`${s[e].name}`,a.textContent=`${s[e].moves}`,o.textContent=`${c<10?"0"+c:c} : ${l<10?"0"+l:l} : ${r<10?"0"+r:r}`,t.append(n),t.append(a),t.append(o),S.append(t)}w.append(S),document.body.append(w),w.classList.remove("hidden"),F.classList.remove("hidden"),F.classList.add("overlay"),w.classList.add("modal_results"),M.classList.add("results_title"),S.classList.add("results_table")}(e),document.body.addEventListener("click",z)}()}function z(e){let t=e.target;(t.closest(".modal_results")||t.closest(".overlay"))&&(w.classList.remove("modal_results"),F.classList.remove("overlay"),w.classList.add("hidden"),F.classList.add("hidden"),document.body.removeEventListener("click",z),w.innerHTML="")}function T(){for(G.removeEventListener("click",$),ee(g(K));!0!==x();)ee(g(K));e(X,K),n=setInterval(d,1e3),V.style.backgroundColor="#ff8c69",O.removeEventListener("click",T),U.addEventListener("click",h),A.removeEventListener("click",_)}function I(){clearInterval(n),ne(Number(Y.dataset.dim))}const N=document.createElement("DIV"),H=document.createElement("DIV"),O=document.createElement("button"),V=document.createElement("button"),A=document.createElement("button"),J=document.createElement("button"),P=document.createElement("img"),W=document.createElement("div"),j=document.createElement("div"),D=document.createElement("span"),R=document.createElement("div"),B=document.createElement("span"),F=document.createElement("div"),U=document.createElement("div"),Y=document.createElement("div"),q=document.createElement("span"),G=document.createElement("div");let K,Q,X,Z;function ee(e){return X=k(e),X}function te(e){return Q=function(e){let t=[],n=1,a=e*e;for(;n<=a;)t.push(n),n++;return t}(e),Q}function ne(t){Y.dataset.dim=`${t}`,K=t,f=0,te(K),X=k(Q),Z=[3,4,5,6,7,8],clearInterval(n),a=0,o=0,s=0,D.textContent="0",q.textContent=`${K} х ${K}`,B.textContent="00 : 00 : 00",V.style.backgroundColor="gray",e(X,K),function(e){let t=e;G.innerHTML="";for(let e=0;e<t.length;e++){const n=document.createElement("div");n.classList.add("size"),n.dataset.sizeValue=`${t[e]}`,n.textContent=`${t[e]}х${t[e]}`,G.append(n)}}(Z),G.addEventListener("click",$),O.addEventListener("click",T),U.removeEventListener("click",h),V.addEventListener("click",I),A.addEventListener("click",_)}A.addEventListener("click",_),J.addEventListener("click",(function(){J.classList.toggle("isMute")})),window.addEventListener("load",(function(){document.body.prepend(F),N.classList.add("container"),H.classList.add("btn_wrapper"),O.classList.add("btn"),V.classList.add("btn"),A.classList.add("btn"),J.classList.add("muteBtn"),W.classList.add("progress_wrapper"),G.classList.add("sizes"),O.textContent="Shuffle and start",V.textContent="Reset",A.textContent="Results",j.textContent="Moves: ",D.textContent="0",R.textContent="Time: ",Y.textContent="Frame size: ",O.style.backgroundColor="#0abab5",A.style.backgroundColor="#0abab5",P.setAttribute("src","src/mute-icon.png"),R.style.marginLeft="15px",Y.style.marginTop="10px",G.style.marginTop="10px",H.append(O),H.append(V),H.append(A),J.append(P),W.append(j),j.append(D),W.append(R),R.append(B),Y.append(q),document.body.prepend(N),N.append(J),N.append(H),N.append(W),U.classList.add("game-field"),U.style.marginTop="10px",U.style.width=H.offsetWidth+"px",U.style.height=window.getComputedStyle(H).getPropertyValue("width"),N.append(U),N.append(Y),N.append(G),ne(4)}))})();